<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

.topnav {
  overflow: hidden;
  background-color: #333;
}

.topnav a {
  float: left;
  display: block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: black;
  color: white;
}

.topnav .icon {
  display: none;
}

@media screen and (max-width: 600px) {
  .topnav a:not(:first-child) {display: none;}
  .topnav a.icon {
    float: right;
    display: block;
  }
}

@media screen and (max-width: 600px) {
  .topnav.responsive {position: relative;}
  .topnav.responsive .icon {
    position: absolute;
    right: 0;
    top: 0;
  }
  .topnav.responsive a {
    float: none;
    display: block;
    text-align: left;
  }
}
</style>
</head>
<body>

<div class="topnav" id="myTopnav">
  <a href="#home" class="active"><strong style="color:grey">Magnitudo</strong></a>
  <div style="float:right;">
  <a onclick="joinRoom()">Join</a>
  <a onclick="createRoom()">Create</a>
  <a href="https:www.pranavsai.ml">About</a>
  <a href="javascript:void(0);" class="icon" onclick="myFunction()">
    <i class="fa fa-bars"></i>
  </a>
  </div>
</div>


<script>
function myFunction() {
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}
</script>

</body>
</html>

<html>

<head>
    <title>MagnitudoMeet</title>
</head>
<style>
body{
    margin: 0;
    background-color: grey;
    font-family: Arial, Helvetica, sans-serif;
}

.title{
    top: 0;
    width: 100%;
    max-width: 100%;
    z-index: 1;
    display: block;
  
    position: absolute;
    background-color:black;
    color: white;
   margin: 0;
}

.entry-modal{
    border: 1px solid #444444;
    width: 300px;
    margin: auto;
    z-index: 9999;
    position: absolute;
    left: 50%;
    top: 70;
    margin-left: -150px;
    padding: 5px;
    color: #fff;
    background-color: #444444;
    text-align: center;
}

#notification{
    position: absolute;
    z-index: 1;
    text-align: center;
    color: #fff;
    margin: 0;
    top: 47.33px;
    font-size: 18pt;
    width: 100%;
    background-color: orange;
}


.room-input{
  border: none;
  padding:5px;
}

button{
    margin: 3px;
    padding: 5px;
}

#remote-video{
    top: 0;
    height: 100%;
    width: 100%;
    left: 0;
    background-color: lightgray;
    position: absolute;
}

#local-video{
    top: 60;
    width: 30;
    object-fit: cover;
    height: 100;
    z-index: 1;
    right: 15;
    background-color: #444444;
    float:"top";
    float:"right";
}
.meet-controls-bar{
    bottom: 0;
    background-color: black;
    left: 0;
    position: absolute;
    width: 100%;
}
</style>

<body>
    <p id="notification" hidden></p>
    
    <div id="1"class="meet-area">
        <!-- Remote Video Element-->
        <video id="remote-video"></video>

        <!-- Local Video Element-->
        <video id="local-video"></video>
        <div class="meet-controls-bar">
            <button onclick="startScreenShare()">Screen Share</button>
        </div>
    </div>
</body>

<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script>
    document.getElementById("1").style.display="none";
    const PRE = "MAGNITUDO"
    const SUF = "MEET"
    var room_id;
    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    var local_stream;
    var screenStream;
    var peer = null;
    var currentPeer = null
    var screenSharing = false
    function createRoom() {
        document.getElementById("1").style.display="block";
        console.log("Creating Room")
        room_id = prompt("What is the Meeting Id?");
        peer = new Peer(room_id)
        peer.on('open', (id) => {
            console.log("Peer Connected with ID: ", id)
            //hideModal()
            document.getElementById("1").style.display="block";
            getUserMedia({ video: true, audio: true }, (stream) => {
                local_stream = stream;
                setLocalStream(local_stream)
            }, (err) => {
                console.log(err)
            })
            notify("Waiting for peer to join.")
        })
        peer.on('call', (call) => {
            call.answer(local_stream);
            call.on('stream', (stream) => {
                setRemoteStream(stream)
            })
            currentPeer = call;
        })
    }
    
    function setLocalStream(stream) {
    
        let video = document.getElementById("local-video");
        video.srcObject = stream;
        video.muted = true;
        video.play();
    }
    function setRemoteStream(stream) {
    
        let video = document.getElementById("remote-video");
        video.srcObject = stream;
        video.play();
    }
    
    function hideModal() {
        document.getElementById("entry-modal").hidden = true
    }
    
    function notify(msg) {
        let notification = document.getElementById("notification")
        notification.innerHTML = msg
        notification.hidden = false
        setTimeout(() => {
            notification.hidden = true;
        }, 3000)
    }
    
    function joinRoom() {
        document.getElementById("1").style.display="block";
        console.log("Joining Room")
        let room = prompt("What is the Meeting-Id?");
        if (room == " " || room == "") {
            alert("Invalid Id");
            return;
        }
        room_id =room;
        //hideModal()
        peer = new Peer()
        peer.on('open', (id) => {
            console.log("Connected with Id: " + id)

            getUserMedia({ video: true, audio: true }, (stream) => {
                local_stream = stream;
                setLocalStream(local_stream)
                notify("Joining peer...")
                let call = peer.call(room_id, stream)
                call.on('stream', (stream) => {
                    setRemoteStream(stream);
                })
                currentPeer = call;
            }, (err) => {
                console.log(err)
            })
    
        })
    }
    
    function startScreenShare() {
        if (screenSharing) {
            stopScreenSharing()
        }
        navigator.mediaDevices.getDisplayMedia({ video: true ,audio:true }).then((stream) => {
            screenStream = stream;
            let videoTrack = screenStream.getVideoTracks()[0];
            videoTrack.onended = () => {
                stopScreenSharing()
            }
            if (peer) {
                let sender = currentPeer.peerConnection.getSenders().find(function (s) {
                    return s.track.kind == videoTrack.kind;
                })
                sender.replaceTrack(videoTrack)
                screenSharing = true
            }
            console.log(screenStream)
        })
    }
    
    function stopScreenSharing() {
        if (!screenSharing) return;
        let videoTrack = local_stream.getVideoTracks()[0];
        if (peer) {
            let sender = currentPeer.peerConnection.getSenders().find(function (s) {
                return s.track.kind == videoTrack.kind;
            })
            sender.replaceTrack(videoTrack)
        }
        screenStream.getTracks().forEach(function (track) {
            track.stop();
        });
        screenSharing = false
    }</script>

</html>
